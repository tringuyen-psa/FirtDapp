(()=>{var e={};e.id=299,e.ids=[299],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8816:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>d,routeModule:()=>m,tree:()=>o}),r(3541),r(2029),r(5866);var s=r(3191),n=r(8716),a=r(7922),l=r.n(a),i=r(5231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(t,c);let o=["",{children:["expenses",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3541)),"/home/nvt/Music/Dự \xc1n/FirtDapp/src/app/expenses/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2029)),"/home/nvt/Music/Dự \xc1n/FirtDapp/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/home/nvt/Music/Dự \xc1n/FirtDapp/src/app/expenses/page.tsx"],x="/expenses/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/expenses/page",pathname:"/expenses",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},59:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},4649:()=>{},8325:(e,t,r)=>{Promise.resolve().then(r.bind(r,5626))},5047:(e,t,r)=>{"use strict";var s=r(7389);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},5626:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(326),n=r(5047),a=r(7577),l=r(6087);let i=["Tất cả","Tr\xed","Long","Đức","Đạt","To\xe0n","Quỹ"];function c({onFiltersChange:e}){let[t,r]=(0,a.useState)({month:String(new Date().getMonth()+1),year:String(new Date().getFullYear()),payer:"Tất cả",consumers:[]});!function(e,t){let[r,s]=(0,a.useState)(e)}(t,0);let n=Array.from({length:12},(e,t)=>({value:t+1,label:`Th\xe1ng ${t+1}`})),c=Array.from({length:3},(e,t)=>{let r=new Date().getFullYear()-1+t;return{value:r,label:`Năm ${r}`}});return(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Bộ Lọc"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Th\xe1ng"}),s.jsx("select",{value:t.month,onChange:e=>r({...t,month:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:n.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Năm"}),s.jsx("select",{value:t.year,onChange:e=>r({...t,year:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:c.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Người chi"}),s.jsx("select",{value:t.payer,onChange:e=>r({...t,payer:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:i.map(e=>s.jsx("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Người ti\xeau"}),s.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"* Mặc định: Hiển thị tất cả"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:0===t.consumers.length,onChange:e=>{e.target.checked&&r({...t,consumers:[]})},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),s.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Tất cả"})]}),s.jsx("div",{className:"grid grid-cols-2 gap-1",children:i.filter(e=>"Tất cả"!==e).map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:t.consumers.includes(e),onChange:s=>{let n=s.target.checked?[...t.consumers,e]:t.consumers.filter(t=>t!==e);r({...t,consumers:n})},disabled:0===t.consumers.length,className:`w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 ${0===t.consumers.length?"opacity-50 cursor-not-allowed":""}`}),s.jsx("span",{className:`text-sm font-medium ${"Quỹ"===e?(0,l.s)("Quỹ").text:(0,l.s)(e).text}`,children:e})]},e))})]})]})]})]})}function o({expenses:e}){let t=e=>new Date(e).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),r=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),n=(e,t)=>e/t.length;return s.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ng\xe0y"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"T\xean khoản chi"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Số tiền"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Số tiền mỗi người"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Người chi"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Người ti\xeau"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===e.length?s.jsx("tr",{children:(0,s.jsxs)("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:["Chưa c\xf3 khoản chi n\xe0o. ",s.jsx("a",{href:"/expenses/add",className:"text-blue-600 hover:text-blue-700",children:"Nhập khoản chi mới"})]})}):e.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t(e.expenseDate)}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.description}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:r(e.amount)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-indigo-600 font-medium",children:r(n(e.amount,e.consumers))}),(0,s.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.consumers.length," người)"]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${(0,l.s)(e.payer).bg} ${(0,l.s)(e.payer).text} ${(0,l.s)(e.payer).border} border`,children:e.payer})}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.consumers.map((e,t)=>{let r=(0,l.s)(e);return s.jsx("span",{className:`inline-block px-3 py-1 mr-2 mb-1 text-xs leading-5 font-medium rounded-full border ${r.bg} ${r.text} ${r.border}`,title:e,children:e},t)})})]},e.id))})]})})})}function d(){let e=(0,n.useRouter)(),t={month:String(new Date().getMonth()+1),year:String(new Date().getFullYear()),payer:"Tất cả",consumers:[]},{expenses:r,loading:l,error:i,fetchExpenses:d,clearCache:x}=function(e){let[t,r]=(0,a.useState)([]),[s,n]=(0,a.useState)(!0),[l,i]=(0,a.useState)(null),c=(0,a.useRef)(new Map),o=(0,a.useRef)(""),d=e=>JSON.stringify({month:e.month,year:e.year,payer:e.payer,consumers:e.consumers.sort()}),x=(0,a.useCallback)(async e=>{let t=d(e);if(c.current.has(t)&&o.current===t){r(c.current.get(t)),n(!1);return}try{n(!0),i(null);let s=new URLSearchParams;e.month&&s.append("month",e.month.toString()),e.year&&s.append("year",e.year.toString()),e.payer&&"Tất cả"!==e.payer&&s.append("payer",e.payer),e.consumers.length>0&&s.append("consumers",e.consumers.join(","));let a=await fetch(`/api/expenses?${s.toString()}`);if(!a.ok)throw Error("Failed to fetch expenses");let l=await a.json();c.current.set(t,l),o.current=t,r(l)}catch(e){i(e instanceof Error?e.message:"Unknown error occurred"),console.error("Error fetching expenses:",e)}finally{n(!1)}},[]),u=(0,a.useCallback)(()=>{c.current.clear(),o.current=""},[]),m=(0,a.useCallback)(()=>{o.current&&x(JSON.parse(o.current))},[x]);return{expenses:t,loading:s,error:l,fetchExpenses:x,clearCache:u,refetch:m}}(0),u=r.reduce((e,t)=>e+t.amount,0);return s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,s.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bảng Tổng Hợp Chi Ti\xeau"}),(0,s.jsxs)("p",{className:"text-gray-600 mt-1",children:["Tổng số: ",s.jsx("span",{className:"font-semibold",children:r.length})," khoản chi",r.length>0&&(0,s.jsxs)("span",{children:[" - ",new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(u)]})]})]}),(0,s.jsxs)("div",{className:"space-x-3",children:[s.jsx("button",{onClick:()=>e.push("/"),className:"px-4 py-2 text-gray-600 hover:text-gray-900",children:"← Trang chủ"}),s.jsx("button",{onClick:()=>e.push("/expenses/add"),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"+ Nhập khoản chi"})]})]}),s.jsx(c,{onFiltersChange:d}),i&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,s.jsxs)("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Lỗi khi tải dữ liệu"}),s.jsx("p",{className:"mt-1 text-sm text-red-700",children:i}),s.jsx("div",{className:"mt-2",children:s.jsx("button",{onClick:()=>d(t),className:"text-sm font-medium text-red-600 hover:text-red-500 underline",children:"Thử lại"})})]})]})}),l&&!i?(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-12 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-500",children:"Đang tải dữ liệu..."})]}):i?null:s.jsx(o,{expenses:r})]})})}},6087:(e,t,r)=>{"use strict";r.d(t,{s:()=>n});let s={Trí:{bg:"bg-blue-100",text:"text-blue-800",border:"border-blue-200"},Long:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200"},Đức:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200"},Đạt:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200"},Toàn:{bg:"bg-purple-100",text:"text-purple-800",border:"border-purple-200"},Quỹ:{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200"}};function n(e){return s[e]||{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200"}}},3541:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`/home/nvt/Music/Dự Án/FirtDapp/src/app/expenses/page.tsx#default`)},2029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i,metadata:()=>l});var s=r(9510),n=r(5317),a=r.n(n);r(5023);let l={title:"Quản L\xfd Tiền Trọ",description:"Hệ thống quản l\xfd chi ti\xeau chung cho ph\xf2ng trọ"};function i({children:e}){return s.jsx("html",{lang:"vi",children:s.jsx("body",{className:a().className,children:e})})}},5023:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,347],()=>r(8816));module.exports=s})();